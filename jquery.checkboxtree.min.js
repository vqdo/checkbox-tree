!function(t){function e(e,a){this.element=e,this.options=t.extend({},o,a),this._defaults=o,this._name=n,this.init()}var n="checkboxtree",a="cbt-",d=a+"list",i=a+"expand",c=a+"sublist-checked-none",l=a+"sublist-checked-partial",s=a+"sublist-checked-all",o={data:{}};e.prototype.init=function(){this._addSublist(this.options.data,this.element),this._update()},e.prototype._update=function(t){console.log("Update called"),t?h(t):h(this.options.data,!0)};var h=function(e,n){e&&t.each(e,function(e,a){var i=a._htmlNode;t(i).children("."+d).toggle(a._expanded),t(i).toggleClass("expanded",a._expanded),p(a),n&&h(a.children,!0)})},p=function(e){if(e&&e._htmlNode){var n=e._htmlNode,a=t(n).children("ul"),d=t(a).find("> .cbt-item > .cbt-cb:checked").length;n.removeClass(l+" "+s+" "+c),n.addClass(0>=d?c:d<a.children().length?l:s)}};t.fn[n]=function(a){return t.fn[n].getItems=function(){return a&&a.data||{}},this.each(function(){if(!t.data(this,"plugin_"+n)){var d=new e(this,a);t.data(this,"plugin_"+n,d),t(this).data("tree",d)}})},e.prototype._addSublist=function(e,n){if(n){var d=t("<ul />").addClass(a+"list"),i=this;t.isArray(e)&&t.each(e,function(t,e){i._addItem(e,d)}),t(n).append(d)}},e.prototype._addItem=function(e,n){if(e&&n){var d=t("<li />").addClass(a+"item");if(this._initExpandable(e,d),e&&(this._addCheckbox(e,d,n),e.children)){this._addSublist(e.children,d);var i=t(d).children("ul");t(d).on("change",i,function(){p(e)})}t(n).append(d)}},e.prototype._addCheckbox=function(e,n){var d=t('<input type="checkbox" />'),i=t("<label />"),c=a+e.name,l=a+"cb";d.attr("name",c).attr("checked",e.selected).addClass(l),i.attr("for",c).html(e.name),e.children=e.children||[],e.selected=!!e.selected,e._expanded=!!e.selected,e._htmlNode=n,n.append(d).append(i)},e.prototype._initExpandable=function(e,n){var a=t("<span />").addClass(i);a.click(t.proxy(function(){e._expanded=!e._expanded,this._update([e])},this)),e.children||a.attr("disabled",!0),n.append(a)}}(jQuery);