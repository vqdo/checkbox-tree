!function(t){function e(e,d){this.element=e,this.options=t.extend({},h,d),this._defaults=h,this._name=n,this.init()}var n="checkboxtree",d="cbt-",i=d+"list",a=d+"expand",l=d+"sublist-checked-none",c=d+"sublist-checked-partial",s=d+"sublist-checked-all",h={data:{}};e.prototype.init=function(){this._addSublist(this.options.data,this.element),this._update()},e.prototype._update=function(t){console.log("Update called"),t?o(t):o(this.options.data,!0)};var o=function(e,n){e&&t.each(e,function(e,d){var a=d._htmlNode;t(a).children("."+i).toggle(d._expanded),t(a).toggleClass("expanded",d._expanded),p(d),n&&o(d.children,!0)})},p=function(e){if(e&&e._htmlNode){var n=e._htmlNode,d=t(n).children("ul"),i=t(d).find("> .cbt-item > .cbt-cb:checked").length;n.removeClass(c+" "+s+" "+l),n.addClass(0>=i?l:i<d.children().length?c:s)}};t.fn[n]=function(d){return t.fn[n].getItems=function(){return d&&d.data||{}},this.each(function(){if(!t.data(this,"plugin_"+n)){var i=new e(this,d);t.data(this,"plugin_"+n,i),t(this).data("tree",i)}})},e.prototype._addSublist=function(e,n){if(n){var i=t("<ul />").addClass(d+"list"),a=this;t.isArray(e)&&t.each(e,function(t,e){a._addItem(e,i)}),t(n).append(i)}},e.prototype._addItem=function(e,n){if(e&&n){var i=t("<li />").addClass(d+"item");if(this._initExpandable(e,i),e&&(this._addCheckbox(e,i),e.children&&e.children.length)){this._addSublist(e.children,i);var a=t(i).children("ul");t(i).on("change",a,function(){p(e)})}t(n).append(i)}},e.prototype._addCheckbox=function(e,n){var i=t('<input type="checkbox" />'),a=t("<label />"),l=d+e.name,c=d+"cb";i.attr("name",l).attr("checked",e.selected).addClass(c),a.attr("for",l).html(e.name),e.children=e.children||[],e.selected=!!e.selected,e._expanded=!!e.selected,e._htmlNode=n,n.append(i).append(a)},e.prototype._initExpandable=function(e,n){var d=t("<span />").addClass(a);d.click(t.proxy(function(){e._expanded=!e._expanded,this._update([e])},this)),e.children&&e.children.length||d.attr("disabled",!0),n.append(d)}}(jQuery);